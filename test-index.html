<html>
<head>
<style>
  html, body { margin: 0; height: 100%; }
.container { display: flex; height: auto; }
.folders {
  flex: 1;
  height: calc(100vh - 20px);
  background-color: #555;
  padding: 10px;
  overflow-y: hidden;
}
.img-box {
  flex: 3;
/*   display: flex; */
  padding: 5px 0px 0px 5px;
  background-color: #333;
}
.img-box img {
  max-width:100%;
  max-height:100%;
}
/* folders */
li { list-style: none; }
li a {
  color: lime;
}
</style>
</head>
  <body>
    <div class="container">
      <div class="folders">
          <ul id="album-list"><li>Loading</li></ul>
      </div>
      <picture class="img-box">
        <img id="web-img">
      </picture>
      </img>
    </div>

<script type="text/javascript">
// const SERVER_NAME = 'https://howtoterminal.com';
// const SERVER_NAME = 'http://67.214.255.152';
const SERVER_NAME = 'http://localhost:8888'
const BASE_URL = `${SERVER_NAME}`;
const PHOTO_DIR = `/photo`;
const PHOTO_URL = `${SERVER_NAME}${PHOTO_DIR}`
const IMAGE_FORMAT = supportsWebP() ? 'webp' : 'jpg';
// const PATHS = {
//   albumList: '?action=album_names',
//   photoList: '?action=pictures_in_album&album='
// };
const PATHS = {
  albumList: '/directories',
  photoList: '/images/'
};

//set default picture
let picture = document.querySelector('.container .web');
let alName = 'goods';
let picName = 'eel3';
let picUrl = `${PHOTO_URL}/${alName}/.web/${picName}`;
let imgEl = document.querySelector('img#web-img');
// imgEl.setAttribute('src', `${picUrl}.${IMAGE_FORMAT}`);
imgEl.setAttribute('alt', 'eel');

/* get album names */
function getAlbums() {
  console.log(`getting albums via ${PATHS.albumList}`);
  return fetch(`${BASE_URL}${PATHS.albumList}`, { mode: 'cors' })
    .then(res => {
      if (typeof res === 'string') return false;
      return res.json();
    });
}
/* clean lists */
function removeChildren(parent) {
  if (!parent || parent.children.length === 0) return false;
  let previousAlbums = Array.from(parent.children);
  previousAlbums.forEach(child => {
    parent.removeChild(child);
  });
}
/* do it all again */
function refreshAlbums(albumNames) {
  let albumList = document.querySelector('#album-list');
  removeChildren(albumList);
  albumNames.forEach(album => {
    let a = document.createElement('a');
    // a.setAttribute('href', `${BASE_URL}?action=album&album=${album}`);
    a.setAttribute('href', `javascript:void(0);`);
    a.setAttribute('id', `a-${album}`);
    a.setAttribute('data-album', `${album}`);
    a.innerHTML = `${album}`;
    a.addEventListener('click', e => {
      getImages(`${album}`).then((data) => refreshImages(data, album));
    });
    let li = document.createElement('li');
    li.setAttribute('id', `li-${album}`);
    li.appendChild(a);
    //link that tears down dom and inserts new images from request for that guy
    albumList.appendChild(li);
  });
}
/* get images from an album */
function getImages(albumName) {
  console.log(`getting images via ${PATHS.photoList}${albumName}`);
  return fetch(`${BASE_URL}${PATHS.photoList}${albumName}`, { mode: 'cors' })
    .then(res => {
      if (typeof res === 'string') return false;
      return res.json();
    });
}
function refreshImages(imageNames, album) {
  let albumHeading = document.querySelector(`#a-${album}`);
  let albumLi = document.querySelector(`#li-${album}`);
  removeChildren(albumLi);
  albumLi.appendChild(albumHeading);
  let ul = document.createElement('ul');
  imageNames.forEach(image => {
    let a = document.createElement('a');
    a.setAttribute('href', `javascript:void(0);`);
    a.setAttribute('id', `i-${image}`);
    a.setAttribute('data-album', `${album}`);
    a.setAttribute('data-image', `${image}`);
    a.innerHTML = `${image}`;
    let li = document.createElement('li');
    a.addEventListener('mouseover', ev => {
      let thumbnail = document.querySelector('img#web-img');
      let formattedImage = image.split('.')[0]+'.'+IMAGE_FORMAT;
      thumbnail.src = `${SERVER_NAME}${PHOTO_DIR}/${album}/.web/${formattedImage}`;
      console.log(`mousing over ${SERVER_NAME}${PHOTO_DIR}/${album}/.web/${formattedImage}`);
      thumbnail.parentElement.href = `${SERVER_NAME}${PHOTO_DIR}/${album}/.web/${formattedImage}`;
    });
    li.appendChild(a);
    ul.appendChild(li);
  });
  document.querySelector(`#li-${album}`).appendChild(ul);
}
function supportsWebP() {
  let el = document.createElement('canvas');
  if (el.getContext && el.getContext('2d')) {
    return el.toDataURL('image/webp').indexOf('data:image/webp') === 0;
  }
  return false;
}
getAlbums().then(refreshAlbums);
</script>
</body>
</html>
